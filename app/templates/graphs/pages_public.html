{% extends 'base.html' %}
{% block title %}{{ page.title }} (Shared){% endblock %}
{% block heading %}{{ page.title }}{% endblock %}

{% block content %}
<div class="mb-3">
  <a class="btn btn-secondary" href="{{ url_for('graphs.pages_index') }}">Back to Pages</a>
</div>

<div class="card">
  <div class="card-body">
    <h5>{{ page.title }}</h5>
    <p class="text-muted">Shared on {{ (page.created_at.isoformat() if page.created_at else '') }}</p>
    <p>Click below to download the page JSON which can be imported into another instance or used to recreate the page.</p>
    <a class="btn btn-primary" href="{{ url_for('graphs.public_page_download', token=share_token) }}">Download JSON</a>
  </div>
</div>

<div class="mt-3">
  <h6>Preview</h6>
  <div class="card p-3">
    {% for w in widgets %}
      <div class="mb-3">
        <strong class="text-capitalize">{{ w.type }}</strong>
        {% if w.type == 'image' %}
          <div class="mt-2">
            {% if w.image_url %}
              <img src="{{ w.image_url }}" alt="{{ w.image_alt or '' }}" style="max-width:100%;height:auto;object-fit: {{ w.image_size or 'contain' }};">
            {% else %}
              <div class="border rounded p-3 text-center bg-light">
                <div style="width:100%;height:150px;display:flex;align-items:center;justify-content:center;color:#666;">No image provided</div>
              </div>
            {% endif %}
            {% if w.image_alt %}
              <div class="small text-muted mt-1">{{ w.image_alt }}</div>
            {% endif %}
          </div>
        {% else %}
          <pre style="white-space:pre-wrap">{{ w|tojson|safe }}</pre>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
