{% extends 'base.html' %}

{% block title %}View Qualitative Scouting{% endblock %}

{% block heading %}Qualitative Scouting Details{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header {% if entry.alliance_scouted and entry.alliance_scouted.startswith('team_') %}bg-success{% elif entry.alliance_scouted == 'red' %}bg-danger{% elif entry.alliance_scouted == 'blue' %}bg-primary{% else %}bg-secondary{% endif %} text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-star me-2"></i>
                        {% if entry.alliance_scouted and entry.alliance_scouted.startswith('team_') %}
                        Individual Team Scouting - Team {{ entry.alliance_scouted.replace('team_', '') }}
                        ({{ entry.match.event.code if entry.match and entry.match.event else '' }} - {{ entry.match.match_type }} {{ entry.match.match_number }})
                        {% else %}
                        {{ entry.match.event.code if entry.match and entry.match.event else '' }} - 
                        {{ entry.match.match_type }} {{ entry.match.match_number }}
                        {% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Match:</dt>
                                <dd class="col-sm-8">
                                    <span class="badge bg-secondary">{{ entry.match.event.code if entry.match and entry.match.event else '' }}</span>
                                    {{ entry.match.match_type }} {{ entry.match.match_number }}
                                </dd>
                                
                                {% if entry.alliance_scouted and entry.alliance_scouted.startswith('team_') %}
                                <dt class="col-sm-4">Team Number:</dt>
                                <dd class="col-sm-8">
                                    <span class="badge bg-success">{{ entry.alliance_scouted.replace('team_', '') }}</span>
                                </dd>
                                <dt class="col-sm-4">Type:</dt>
                                <dd class="col-sm-8"><span class="badge bg-success">Individual</span></dd>
                                {% else %}
                                <dt class="col-sm-4">Alliance Scouted:</dt>
                                <dd class="col-sm-8">
                                    <span class="badge {% if entry.alliance_scouted == 'red' %}bg-danger{% elif entry.alliance_scouted == 'blue' %}bg-primary{% else %}bg-secondary{% endif %}">
                                        {{ entry.alliance_scouted|title }}
                                    </span>
                                </dd>
                                {% endif %}
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Scout:</dt>
                                <dd class="col-sm-8">{{ entry.scout_name }}</dd>
                                
                                <dt class="col-sm-4">Timestamp:</dt>
                                <dd class="col-sm-8">{{ entry.timestamp.strftime('%Y-%m-%d %H:%M') if entry.timestamp else '' }}</dd>
                            </dl>
                        </div>
                    </div>

                    {% if entry.data and entry.data.get('_match_summary') %}
                    <div class="mb-3">
                        <strong>Match summary:</strong>
                        <div class="small text-muted mt-1">
                            {% set ms = entry.data['_match_summary'] %}
                            {% if ms.roles_performed %}<div><strong>Roles:</strong> {{ ms.roles_performed|join(', ') }}</div>{% endif %}
                            {% if ms.can_score_while_moving %}<div><strong>Field:</strong> Scores while moving</div>{% endif %}
                            {% if ms.driver_ability %}<div><strong>Driver ability:</strong> {{ ms.driver_ability }}/5</div>{% endif %}
                            {% if ms.defense_effectiveness %}<div><strong>Defense effectiveness:</strong> {{ ms.defense_effectiveness }}/5</div>{% endif %}
                            {% if ms.shot_accuracy is not none %}<div><strong>Shot accuracy:</strong> {{ ms.shot_accuracy }}/5</div>{% endif %}
                            {% if ms.got_beached %}<div><strong>Notes:</strong> Got beached</div>{% endif %}
                            {% if ms.feeder_type and ms.feeder_type|length > 0 %}<div><strong>Feeder type:</strong> {{ ms.feeder_type|join(', ') }}</div>{% endif %}
                        </div>
                    </div>
                    {% endif %}


                    <!-- Red Alliance Data -->
                    {% if data.red and (entry.alliance_scouted == 'red' or entry.alliance_scouted == 'both') %}
                    <div class="mb-4">
                        <h5 class="text-danger mb-3">
                            <i class="fas fa-square me-2"></i>Red Alliance
                        </h5>
                        <div class="row">
                            {% for team_key, team_data in data.red.items() %}
                            {% set team_num = team_key.replace('team_', '') %}
                            <div class="col-md-4 mb-3">
                                <div class="card border-danger">
                                    <div class="card-header bg-danger text-white">
                                        <h6 class="mb-0">Team {{ team_num }}</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-2">
                                            <strong>Ranking <span class="text-muted small">(lower is better)</span>:</strong>
                                            {% if team_data.get('ranking') is not none %}
                                            <span class="badge {% if team_data.ranking == 1 %}bg-success{% elif team_data.ranking == 2 %}bg-primary{% else %}bg-warning{% endif %}">
                                                {{ team_data.ranking }}
                                            </span>
                                            {% else %}
                                            <span class="text-muted">Not ranked</span>
                                            {% endif %}
                                        </div>
                                        {% if team_data.get('driver_rating') or team_data.get('robot_rating') or team_data.get('overall_rating') %}
                                        <div class="mb-2">
                                            {% if team_data.get('driver_rating') %}
                                            <strong>Driver:</strong> <span class="text-muted small">(higher is better)</span>
                                            <span class="badge {% if team_data.driver_rating >= 4 %}bg-success{% elif team_data.driver_rating >= 3 %}bg-primary{% elif team_data.driver_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %} me-2">{{ team_data.driver_rating }}/5</span>
                                            {% endif %}
                                            {% if team_data.get('robot_rating') %}
                                            <strong>Robot:</strong>
                                            <span class="badge {% if team_data.robot_rating >= 4 %}bg-success{% elif team_data.robot_rating >= 3 %}bg-primary{% elif team_data.robot_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %} me-2">{{ team_data.robot_rating }}/5</span>
                                            {% endif %}
                                            {% if team_data.get('overall_rating') %}
                                            <strong>Overall:</strong>
                                            <span class="badge {% if team_data.overall_rating >= 4 %}bg-success{% elif team_data.overall_rating >= 3 %}bg-primary{% elif team_data.overall_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %}">{{ team_data.overall_rating }}/5</span>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                        {% if team_data.get('cycling') or team_data.get('stealing') or team_data.get('scoring') or team_data.get('feeding') or team_data.get('defending') or team_data.get('did_not_contribute') %}
                                        <div class="mb-2">
                                            <strong>Roles:</strong>
                                            <div class="mt-1">
                                                {% if team_data.get('cycling') %}<span class="badge bg-primary me-1">Cycling</span>{% endif %}
                                                {% if team_data.get('stealing') %}<span class="badge bg-warning text-dark me-1">Stealing</span>{% endif %}
                                                {% if team_data.get('scoring') %}<span class="badge bg-success me-1">Scoring</span>{% endif %}
                                                {% if team_data.get('feeding') %}<span class="badge bg-info me-1">Feeding</span>{% endif %}
                                                {% if team_data.get('defending') %}<span class="badge bg-danger me-1">Defending</span>{% endif %}
                                                {% if team_data.get('did_not_contribute') %}<span class="badge bg-secondary me-1">Did Not Contribute</span>{% endif %}
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if team_data.get('can_score_while_moving') %}
                                        <div class="mb-2"><span class="badge bg-info me-1"><i class="fas fa-running me-1"></i>Scores while moving</span></div>
                                        {% endif %}
                                        {% if team_data.get('got_beached') %}
                                        <div class="mb-2"><span class="badge bg-warning text-dark me-1"><i class="fas fa-exclamation-triangle me-1"></i>Got Beached</span></div>
                                        {% endif %}
                                        <div class="mb-2">
                                            <strong>Endgame:</strong>
                                            <p class="mb-0 mt-1">{{ team_data.endgame }}</p>
                                        </div>

                                        {% if team_data.get('endgame_climb_result') %}
                                        <div class="mb-2">
                                            <strong>Endgame climb:</strong>
                                            <span class="badge {% if team_data.endgame_climb_result == 'success' %}bg-success{% else %}bg-danger{% endif %}">{{ team_data.endgame_climb_result|title }}</span>
                                            {% if team_data.endgame_climb_level %}<small class="text-muted ms-2">Level: {{ team_data.endgame_climb_level }}</small>{% endif %}
                                        </div>
                                        {% endif %}

                                        {% if team_data.get('auto_climb_result') %}
                                        <div class="mb-2">
                                            <strong>Auto climb:</strong>
                                            <span class="badge {% if team_data.auto_climb_result == 'success' %}bg-success{% else %}bg-danger{% endif %}">{{ team_data.auto_climb_result|title }}</span>
                                        </div>
                                        {% endif %}

                                        {% if team_data.get('feeder_type') %}
                                        <div class="mb-2">
                                            <strong>Feeder:</strong>
                                            {% for f in team_data.feeder_type %}
                                                <span class="badge bg-info me-1">{{ f.replace('_',' ').title() }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}

                                        <div>
                                            <strong>Notes:</strong>
                                            <p class="mb-0 mt-1">
                                                {{ team_data.notes if team_data.notes else 'No notes' }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Blue Alliance Data -->
                    {% if data.blue and (entry.alliance_scouted == 'blue' or entry.alliance_scouted == 'both') %}
                    <div class="mb-4">
                        <h5 class="text-primary mb-3">
                            <i class="fas fa-square me-2"></i>Blue Alliance
                        </h5>
                        <div class="row">
                            {% for team_key, team_data in data.blue.items() %}
                            {% set team_num = team_key.replace('team_', '') %}
                            <div class="col-md-4 mb-3">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">Team {{ team_num }}</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-2">
                                            <strong>Ranking <span class="text-muted small">(lower is better)</span>:</strong>
                                            {% if team_data.get('ranking') is not none %}
                                            <span class="badge {% if team_data.ranking == 1 %}bg-success{% elif team_data.ranking == 2 %}bg-primary{% else %}bg-warning{% endif %}">
                                                {{ team_data.ranking }}
                                            </span>
                                            {% else %}
                                            <span class="text-muted">Not ranked</span>
                                            {% endif %}
                                        </div>
                                        {% if team_data.get('driver_rating') or team_data.get('robot_rating') or team_data.get('overall_rating') %}
                                        <div class="mb-2">
                                            {% if team_data.get('driver_rating') %}
                                            <strong>Driver:</strong> <span class="text-muted small">(higher is better)</span>
                                            <span class="badge {% if team_data.driver_rating >= 4 %}bg-success{% elif team_data.driver_rating >= 3 %}bg-primary{% elif team_data.driver_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %} me-2">{{ team_data.driver_rating }}/5</span>
                                            {% endif %}
                                            {% if team_data.get('robot_rating') %}
                                            <strong>Robot:</strong>
                                            <span class="badge {% if team_data.robot_rating >= 4 %}bg-success{% elif team_data.robot_rating >= 3 %}bg-primary{% elif team_data.robot_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %} me-2">{{ team_data.robot_rating }}/5</span>
                                            {% endif %}
                                            {% if team_data.get('overall_rating') %}
                                            <strong>Overall:</strong>
                                            <span class="badge {% if team_data.overall_rating >= 4 %}bg-success{% elif team_data.overall_rating >= 3 %}bg-primary{% elif team_data.overall_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %}">{{ team_data.overall_rating }}/5</span>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                        {% if team_data.get('cycling') or team_data.get('stealing') or team_data.get('scoring') or team_data.get('feeding') or team_data.get('defending') or team_data.get('did_not_contribute') %}
                                        <div class="mb-2">
                                            <strong>Roles:</strong>
                                            <div class="mt-1">
                                                {% if team_data.get('cycling') %}<span class="badge bg-primary me-1">Cycling</span>{% endif %}
                                                {% if team_data.get('stealing') %}<span class="badge bg-warning text-dark me-1">Stealing</span>{% endif %}
                                                {% if team_data.get('scoring') %}<span class="badge bg-success me-1">Scoring</span>{% endif %}
                                                {% if team_data.get('feeding') %}<span class="badge bg-info me-1">Feeding</span>{% endif %}
                                                {% if team_data.get('defending') %}<span class="badge bg-danger me-1">Defending</span>{% endif %}
                                                {% if team_data.get('did_not_contribute') %}<span class="badge bg-secondary me-1">Did Not Contribute</span>{% endif %}
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if team_data.get('can_score_while_moving') %}
                                        <div class="mb-2"><span class="badge bg-info me-1"><i class="fas fa-running me-1"></i>Scores while moving</span></div>
                                        {% endif %}
                                        {% if team_data.get('got_beached') %}
                                        <div class="mb-2"><span class="badge bg-warning text-dark me-1"><i class="fas fa-exclamation-triangle me-1"></i>Got Beached</span></div>
                                        {% endif %}

                                        {% if team_data.get('endgame_climb_result') %}
                                        <div class="mb-2">
                                            <strong>Endgame climb:</strong>
                                            <span class="badge {% if team_data.endgame_climb_result == 'success' %}bg-success{% else %}bg-danger{% endif %}">{{ team_data.endgame_climb_result|title }}</span>
                                            {% if team_data.endgame_climb_level %}<small class="text-muted ms-2">Level: {{ team_data.endgame_climb_level }}</small>{% endif %}
                                        </div>
                                        {% endif %}

                                        {% if team_data.get('auto_climb_result') %}
                                        <div class="mb-2">
                                            <strong>Auto climb:</strong>
                                            <span class="badge {% if team_data.auto_climb_result == 'success' %}bg-success{% else %}bg-danger{% endif %}">{{ team_data.auto_climb_result|title }}</span>
                                        </div>
                                        {% endif %}

                                        {% if team_data.get('feeder_type') %}
                                        <div class="mb-2">
                                            <strong>Feeder:</strong>
                                            {% for f in team_data.feeder_type %}
                                                <span class="badge bg-info me-1">{{ f.replace('_',' ').title() }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}

                                        <div>
                                            <strong>Notes:</strong>
                                            <p class="mb-0 mt-1">
                                                {{ team_data.notes if team_data.notes else 'No notes' }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Individual Team Data -->
                    {% if data.individual %}
                    <div class="mb-4">
                        <h5 class="text-success mb-3">
                            <i class="fas fa-user me-2"></i>Individual Team Scouting
                        </h5>
                        <div class="row">
                            {% for team_key, team_data in data.individual.items() %}
                            {% set team_num = team_key.replace('team_', '') %}
                            <div class="col-md-6 mb-3">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">Team {{ team_num }}</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-2">
                                            <strong>Ranking <span class="text-muted small">(lower is better)</span>:</strong>
                                            {% if team_data.get('ranking') is not none %}
                                            <span class="badge {% if team_data.ranking == 1 %}bg-success{% elif team_data.ranking == 2 %}bg-primary{% elif team_data.ranking == 3 %}bg-warning{% else %}bg-secondary{% endif %}">
                                                {{ team_data.ranking }}
                                                {% if team_data.ranking == 1 %}- Excellent
                                                {% elif team_data.ranking == 2 %}- Good
                                                {% elif team_data.ranking == 3 %}- Average
                                                {% endif %}
                                            </span>
                                            {% else %}
                                            <span class="text-muted">Not ranked</span>
                                            {% endif %}
                                        </div>
                                        {% if team_data.get('driver_rating') or team_data.get('robot_rating') or team_data.get('overall_rating') %}
                                        <div class="mb-2">
                                            {% if team_data.get('driver_rating') %}
                                            <strong>Driver:</strong> <span class="text-muted small">(higher is better)</span>
                                            <span class="badge {% if team_data.driver_rating >= 4 %}bg-success{% elif team_data.driver_rating >= 3 %}bg-primary{% elif team_data.driver_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %} me-2">{{ team_data.driver_rating }}/5</span>
                                            {% endif %}
                                            {% if team_data.get('robot_rating') %}
                                            <strong>Robot:</strong>
                                            <span class="badge {% if team_data.robot_rating >= 4 %}bg-success{% elif team_data.robot_rating >= 3 %}bg-primary{% elif team_data.robot_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %} me-2">{{ team_data.robot_rating }}/5</span>
                                            {% endif %}
                                            {% if team_data.get('overall_rating') %}
                                            <strong>Overall:</strong>
                                            <span class="badge {% if team_data.overall_rating >= 4 %}bg-success{% elif team_data.overall_rating >= 3 %}bg-primary{% elif team_data.overall_rating >= 2 %}bg-warning text-dark{% else %}bg-danger{% endif %}">{{ team_data.overall_rating }}/5</span>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                        {% if team_data.get('cycling') or team_data.get('stealing') or team_data.get('scoring') or team_data.get('feeding') or team_data.get('defending') or team_data.get('did_not_contribute') %}
                                        <div class="mb-2">
                                            <strong>Roles:</strong>
                                            <div class="mt-1">
                                                {% if team_data.get('cycling') %}<span class="badge bg-primary me-1">Cycling</span>{% endif %}
                                                {% if team_data.get('stealing') %}<span class="badge bg-warning text-dark me-1">Stealing</span>{% endif %}
                                                {% if team_data.get('scoring') %}<span class="badge bg-success me-1">Scoring</span>{% endif %}
                                                {% if team_data.get('feeding') %}<span class="badge bg-info me-1">Feeding</span>{% endif %}
                                                {% if team_data.get('defending') %}<span class="badge bg-danger me-1">Defending</span>{% endif %}
                                                {% if team_data.get('did_not_contribute') %}<span class="badge bg-secondary me-1">Did Not Contribute</span>{% endif %}
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if team_data.get('can_score_while_moving') %}
                                        <div class="mb-2"><span class="badge bg-info me-1"><i class="fas fa-running me-1"></i>Scores while moving</span></div>
                                        {% endif %}
                                        {% if team_data.get('got_beached') %}
                                        <div class="mb-2"><span class="badge bg-warning text-dark me-1"><i class="fas fa-exclamation-triangle me-1"></i>Got Beached</span></div>
                                        {% endif %}
                                        {% if team_data.get('endgame_climb_result') %}
                                        <div class="mb-2">
                                            <strong>Endgame climb:</strong>
                                            <span class="badge {% if team_data.endgame_climb_result == 'success' %}bg-success{% else %}bg-danger{% endif %}">{{ team_data.endgame_climb_result|title }}</span>
                                            {% if team_data.endgame_climb_level %}<small class="text-muted ms-2">Level: {{ team_data.endgame_climb_level }}</small>{% endif %}
                                        </div>
                                        {% endif %}

                                        {% if team_data.get('auto_climb_result') %}
                                        <div class="mb-2">
                                            <strong>Auto climb:</strong>
                                            <span class="badge {% if team_data.auto_climb_result == 'success' %}bg-success{% else %}bg-danger{% endif %}">{{ team_data.auto_climb_result|title }}</span>
                                        </div>
                                        {% endif %}

                                        {% if team_data.get('feeder_type') %}
                                        <div class="mb-2">
                                            <strong>Feeder:</strong>
                                            {% for f in team_data.feeder_type %}
                                                <span class="badge bg-info me-1">{{ f.replace('_',' ').title() }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}

                                        <div>
                                            <strong>Notes:</strong>
                                            <p class="mb-0 mt-1">
                                                {{ team_data.notes if team_data.notes else 'No notes' }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="text-center mt-4">
                        <a href="{{ url_for('scouting.qualitative_scouting') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Qualitative Scouting
                        </a>
                        <a href="{{ url_for('scouting.qualitative_qr_code', entry_id=entry.id) }}" class="btn btn-success">
                            <i class="fas fa-qrcode me-2"></i>Generate QR Code
                        </a>
                        <a href="{{ url_for('matches.view', match_id=entry.match_id) }}" class="btn btn-primary">
                            <i class="fas fa-eye me-2"></i>View Match
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

