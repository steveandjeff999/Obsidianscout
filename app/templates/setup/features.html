{% extends 'base.html' %}

{% block title %}Features Overview{% endblock %}

{% block heading %}ObsidianScout Features{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12 text-center mb-4">
            <h2><i class="fas fa-star me-2"></i>Comprehensive FRC Scouting Platform</h2>
            <p class="lead text-muted">Discover all the powerful features available in ObsidianScout</p>
        </div>
    </div>

    <!-- Core Features -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h4 class="mb-3"><i class="fas fa-rocket me-2"></i>Core Scouting Features</h4>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 border-success">
                <div class="card-body text-center">
                    <i class="fas fa-clipboard-list fa-3x text-success mb-3"></i>
                    <h5>Match Scouting</h5>
                    <p class="text-muted">Comprehensive match data collection with customizable forms for autonomous, teleop, and endgame phases.</p>
                    <ul class="list-unstyled text-start">
                        <li> Real-time data entry</li>
                        <li> Mobile-optimized interface</li>
                        <li> Offline capability</li>
                        <li> QR code scanning</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 border-info">
                <div class="card-body text-center">
                    <i class="fas fa-tools fa-3x text-info mb-3"></i>
                    <h5>Pit Scouting</h5>
                    <p class="text-muted">Detailed robot and team information collection with structured interview forms.</p>
                    <ul class="list-unstyled text-start">
                        <li> Robot specifications</li>
                        <li> Team capabilities</li>
                        <li> Photo uploads</li>
                        <li> Strategy notes</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 border-warning">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
                    <h5>Data Analytics</h5>
                    <p class="text-muted">Powerful analysis tools to understand team performance and make strategic decisions.</p>
                    <ul class="list-unstyled text-start">
                        <li> Performance graphs</li>
                        <li> Team rankings</li>
                        <li> Trend analysis</li>
                        <li> Custom metrics</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Features -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h4 class="mb-3"><i class="fas fa-cogs me-2"></i>Advanced Capabilities</h4>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5><i class="fas fa-share-alt text-primary me-2"></i>Data Sharing</h5>
                    <p class="text-muted">Share insights with your team and collaborate effectively.</p>
                    <ul class="small">
                        <li><strong>Public Links:</strong> Share graphs and rankings with anyone</li>
                        <li><strong>Team Collaboration:</strong> Multiple users can work simultaneously</li>
                        <li><strong>Real-time Sync:</strong> Data updates across all devices</li>
                        <li><strong>Export Options:</strong> Excel, CSV, and PDF exports</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5><i class="fas fa-wifi text-success me-2"></i>API Integration</h5>
                    <p class="text-muted">Automatic event data synchronization with dual API support.</p>
                    <ul class="small">
                        <li><strong>FIRST API:</strong> Official FRC event data</li>
                        <li><strong>Blue Alliance API:</strong> Community-driven data source</li>
                        <li><strong>Auto Fallback:</strong> Seamless switching between APIs</li>
                        <li><strong>Real-time Updates:</strong> Match schedules and results</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5><i class="fas fa-palette text-info me-2"></i>Customization</h5>
                    <p class="text-muted">Tailor the platform to your team's specific needs.</p>
                    <ul class="small">
                        <li><strong>Game Configuration:</strong> Customize scoring elements for each season</li>
                        <li><strong>Themes:</strong> Multiple visual themes and branding options</li>
                        <li><strong>User Roles:</strong> Flexible permission system</li>
                        <li><strong>Dynamic Forms:</strong> Adapt scouting forms as the game evolves</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5><i class="fas fa-shield-alt text-danger me-2"></i>Security & Reliability</h5>
                    <p class="text-muted">Enterprise-grade security and data protection.</p>
                    <ul class="small">
                        <li><strong>Team Isolation:</strong> Data is segregated by team</li>
                        <li><strong>Secure Authentication:</strong> Role-based access control</li>
                        <li><strong>Data Integrity:</strong> File checksums and validation</li>
                        <li><strong>Activity Logging:</strong> Comprehensive audit trails</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- User Roles -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h4 class="mb-3"><i class="fas fa-users me-2"></i>User Roles & Permissions</h4>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-danger h-100">
                <div class="card-body text-center">
                    <i class="fas fa-crown fa-2x text-danger mb-2"></i>
                    <h6>Administrator</h6>
                    <ul class="list-unstyled small text-start">
                        <li> Full system access</li>
                        <li> User management</li>
                        <li> Configuration</li>
                        <li> Data export</li>
                        <li> System settings</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-info h-100">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
                    <h6>Analytics User</h6>
                    <ul class="list-unstyled small text-start">
                        <li> View all data</li>
                        <li> Create graphs</li>
                        <li> Team rankings</li>
                        <li> Data sharing</li>
                        <li> User management</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-success h-100">
                <div class="card-body text-center">
                    <i class="fas fa-clipboard-list fa-2x text-success mb-2"></i>
                    <h6>Scout</h6>
                    <ul class="list-unstyled small text-start">
                        <li> Match scouting</li>
                        <li> Pit scouting</li>
                        <li> QR scanning</li>
                        <li> Analytics</li>
                        <li> Configuration</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-dark h-100">
                <div class="card-body text-center">
                    <i class="fas fa-user-shield fa-2x text-dark mb-2"></i>
                    <h6>Super Admin</h6>
                    <ul class="list-unstyled small text-start">
                        <li> Cross-team access</li>
                        <li> System-wide management</li>
                        <li> User administration</li>
                        <li> Team data access</li>
                        <li> Scouting features</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Technical Features -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h4 class="mb-3"><i class="fas fa-microchip me-2"></i>Technical Highlights</h4>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6><i class="fas fa-mobile-alt text-primary me-2"></i>Cross-Platform Compatibility</h6>
                    <ul class="list-unstyled small">
                        <li>• Responsive web design works on all devices</li>
                        <li>• Optimized for tablets and smartphones</li>
                        <li>• No app installation required</li>
                        <li>• Works offline with sync when connected</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6><i class="fas fa-database text-success me-2"></i>Data Management</h6>
                    <ul class="list-unstyled small">
                        <li>• SQLite database for reliability</li>
                        <li>• Automatic backups and migrations</li>
                        <li>• Data validation and integrity checks</li>
                        <li>• Real-time synchronization</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6><i class="fas fa-bolt text-warning me-2"></i>Performance</h6>
                    <ul class="list-unstyled small">
                        <li>• Fast loading times and smooth interactions</li>
                        <li>• Efficient data queries and caching</li>
                        <li>• Background processing for heavy operations</li>
                        <li>• Scalable architecture</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6><i class="fas fa-code text-info me-2"></i>Extensibility</h6>
                    <ul class="list-unstyled small">
                        <li>• Modular design for easy customization</li>
                        <li>• Plugin architecture for new features</li>
                        <li>• Open configuration formats</li>
                        <li>• RESTful API for integrations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Getting Started -->
    <div class="row">
        <div class="col-md-12">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h4><i class="fas fa-rocket me-2"></i>Ready to Get Started?</h4>
                    <p class="mb-4">Jump into ObsidianScout and start collecting valuable scouting data for your team.</p>
                    <div class="row justify-content-center">
                        <div class="col-auto me-2">
                            <a href="{{ url_for('setup.tutorial') }}" class="btn btn-light btn-lg">
                                <i class="fas fa-graduation-cap me-2"></i>Take Tutorial
                            </a>
                        </div>
                        <div class="col-auto me-2">
                            <a href="{{ url_for('main.index') }}" class="btn btn-success btn-lg">
                                <i class="fas fa-home me-2"></i>Go to Dashboard
                            </a>
                        </div>
                        <div class="col-auto">
                            <a href="{{ url_for('main.help_page') }}" class="btn btn-info btn-lg">
                                <i class="fas fa-question-circle me-2"></i>Help Center
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External Platforms Comparison -->
    <div class="row mb-5">
        <div class="col-md-12">
            <h4 class="mb-3"><i class="fas fa-table me-2"></i>Platform Comparison</h4>
            <p class="text-muted">Compare ObsidianScout with other common approaches. Data is loaded from a JSON file so it can be edited or extended easily.</p>

            <div class="mb-2 d-flex justify-content-between align-items-center">
                <div class="d-flex gap-2">
                    <button id="export-csv" class="btn btn-outline-primary btn-sm"><i class="fas fa-file-csv me-1"></i>Export CSV</button>
                    <a href="/setup/features/compare" class="btn btn-outline-info btn-sm"><i class="fas fa-external-link-alt me-1"></i>Open Full Page</a>
                    <button id="themeModeBtn" class="btn btn-outline-secondary btn-sm" title="Theme: Auto/Dark/Light">
                        <i id="themeModeIcon" class="fas fa-adjust me-1"></i><span id="themeModeLabel">Auto</span>
                    </button>
                </div>
                <div class="text-muted small align-self-center">Editable JSON located at <code>/static/data/platform_features.json</code></div>
            </div>

            <div id="pf-container" class="u-scrollable-420 border rounded p-2 frosted-compact">
                <table id="platform-features-table" class="table table-sm table-striped table-bordered mb-0 u-min-w-900">
                    <thead><tr id="pf-head"></tr></thead>
                    <tbody id="pf-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add some interactive elements
document.addEventListener('DOMContentLoaded', function() {
    // Animate cards on scroll
    const cards = document.querySelectorAll('.card');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animation = 'fadeInUp 0.5s ease-in-out';
            }
        });
    });

    cards.forEach(card => {
        observer.observe(card);
    });
});
</script>

<style>
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>

<style>
/* Page-specific dark-mode friendly table styles */
#pf-container { transition: background-color 200ms ease, border-color 200ms ease; }
#platform-features-table { color: var(--bs-body-color); }
#platform-features-table thead th { background: rgba(0,0,0,0.03); }
body.dark-mode #platform-features-table thead th { background: rgba(255,255,255,0.04); color: var(--bs-body-color); }
body.dark-mode #pf-container { border-color: rgba(255,255,255,0.06); }
#platform-features-table td, #platform-features-table th { vertical-align: middle; }
</style>

<script>
// Load platform comparison JSON and render as a table with CSV export
document.addEventListener('DOMContentLoaded', function() {
    const dataUrl = '/static/data/platform_features.json';
    const headRow = document.getElementById('pf-head');
    const body = document.getElementById('pf-body');
    const exportBtn = document.getElementById('export-csv');
    const themeBtn = document.getElementById('themeModeBtn');
    const themeIcon = document.getElementById('themeModeIcon');
    const themeLabel = document.getElementById('themeModeLabel');

    function renderTable(data) {
        headRow.innerHTML = '';
        body.innerHTML = '';

        if (!Array.isArray(data) || data.length === 0) {
            headRow.innerHTML = '<th>No data</th>';
            return;
        }

        // Build columns from keys of the first item
        const columns = Object.keys(data[0]);

        // Header
        for (const col of columns) {
            const th = document.createElement('th');
            th.textContent = col;
            headRow.appendChild(th);
        }

        // Body rows
        for (const row of data) {
            const tr = document.createElement('tr');
            for (const col of columns) {
                const td = document.createElement('td');
                const v = row[col] !== undefined ? row[col] : '';
                td.textContent = v;
                tr.appendChild(td);
            }
            body.appendChild(tr);
        }
    }

    function toCSV(data) {
        if (!Array.isArray(data) || data.length === 0) return '';
        const cols = Object.keys(data[0]);
        const escape = (v) => {
            if (v === null || v === undefined) return '';
            const s = String(v);
            if (s.includes(',') || s.includes('"') || s.includes('\n')) {
                return '"' + s.replace(/"/g, '""') + '"';
            }
            return s;
        };

        const rows = [cols.join(',')];
        for (const r of data) {
            rows.push(cols.map(c => escape(r[c])).join(','));
        }
        return rows.join('\n');
    }

    fetch(dataUrl, {cache: 'no-store'})
        .then(res => res.ok ? res.json() : Promise.reject('Failed to load'))
        .then(data => {
            renderTable(data);

            exportBtn.addEventListener('click', function() {
                const csv = toCSV(data);
                const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'platform_features.csv';
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
            });
        })
        .catch(err => {
            console.warn('Could not load platform comparison data:', err);
            headRow.innerHTML = '<th>Error loading data</th>';
            body.innerHTML = '<tr><td>Please check <code>/static/data/platform_features.json</code> exists and contains valid JSON.</td></tr>';
        });
});
</script>

<script>
// Page-level theme mode control (Auto / Dark / Light)
document.addEventListener('DOMContentLoaded', function(){
    const btn = document.getElementById('themeModeBtn');
    const icon = document.getElementById('themeModeIcon');
    const label = document.getElementById('themeModeLabel');

    if(!btn) return;

    function getStored(){ try { return localStorage.getItem('darkMode'); } catch(e){ return null; } }
    function setStored(v){ try { if (v === null) localStorage.removeItem('darkMode'); else localStorage.setItem('darkMode', v); } catch(e){} }
    function applyModeFromStore(){
        const stored = getStored();
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        let useDark = null; // null = auto
        if (stored === 'true') useDark = true;
        else if (stored === 'false') useDark = false;
        else useDark = prefersDark;

        // Apply classes
        if (useDark) {
            document.documentElement.classList.add('dark-mode');
            document.body.classList.add('dark-mode');
        } else {
            document.documentElement.classList.remove('dark-mode');
            document.body.classList.remove('dark-mode');
        }

        // Update label/icon
        if (stored === null) { icon.className = 'fas fa-adjust me-1'; label.textContent = 'Auto'; }
        else if (stored === 'true') { icon.className = 'fas fa-moon me-1'; label.textContent = 'Dark'; }
        else { icon.className = 'fas fa-sun me-1'; label.textContent = 'Light'; }

        // Also update global sidebar button if present
        try {
            const globalIcon = document.getElementById('darkModeIcon');
            const globalLabel = document.getElementById('darkModeLabel');
            if (globalIcon && globalLabel) {
                if (stored === null) { globalIcon.className = 'fas fa-adjust'; globalLabel.textContent = 'Auto'; }
                else if (stored === 'true') { globalIcon.className = 'fas fa-sun'; globalLabel.textContent = 'Light Mode'; }
                else { globalIcon.className = 'fas fa-moon'; globalLabel.textContent = 'Dark Mode'; }
            }
        } catch(e){}
    }

    // Cycle through modes: Auto -> Dark -> Light -> Auto
    btn.addEventListener('click', function(){
        const cur = getStored();
        let next = null;
        if (cur === null) next = 'true';
        else if (cur === 'true') next = 'false';
        else next = null;
        setStored(next);
        applyModeFromStore();
        // notify other tabs via storage event
        try { window.dispatchEvent(new Event('storage')); } catch(e){}
    });

    // Also respond to system preference changes if user hasn't chosen
    try {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (getStored() === null) applyModeFromStore();
        });
    } catch(e){}

    applyModeFromStore();
});
</script>
{% endblock %}
