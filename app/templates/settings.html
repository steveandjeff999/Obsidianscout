{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block heading %}Settings{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Display Preferences</h5>
                <p class="text-muted">Control how offseason teams with letter suffixes are shown in the UI. This preference is saved in your browser only.</p>

                <div class="mb-3">
                    <label class="form-label">Team number display</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="display_pref" id="pref_99xx" value="99xx">
                        <label class="form-check-label" for="pref_99xx">Show numeric 99xx placeholder (default)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="display_pref" id="pref_letter" value="letter">
                        <label class="form-check-label" for="pref_letter">Show original letter-suffixed team IDs (when available)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="display_pref" id="pref_both" value="both">
                        <label class="form-check-label" for="pref_both">Show both: numeric 99xx (and letter in parentheses when available)</label>
                    </div>
                </div>

                <div class="mt-3">
                    <button id="saveSettingsBtn" class="btn btn-primary">Save</button>
                    <button id="resetSettingsBtn" class="btn btn-outline-secondary">Reset to default</button>
                    <div id="settingsStatus" class="mt-2" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function(){
    function readPref(){
        try{ return localStorage.getItem('display_offseason_preference') || '99xx'; } catch(e){ return '99xx'; }
    }
    function writePref(v){ try{ localStorage.setItem('display_offseason_preference', v); }catch(e){} }

    document.addEventListener('DOMContentLoaded', function(){
        var current = readPref();
        document.getElementById('pref_99xx').checked = (current === '99xx');
        document.getElementById('pref_letter').checked = (current === 'letter');
        var prefBothEl = document.getElementById('pref_both'); if(prefBothEl) prefBothEl.checked = (current === 'both');

        var status = document.getElementById('settingsStatus');
        function showStatus(msg, cls){ status.style.display='block'; status.className = 'mt-2 text-'+(cls||'success'); status.textContent = msg; setTimeout(function(){ status.style.display='none'; }, 2500); }

        document.getElementById('saveSettingsBtn').addEventListener('click', function(){
            var v = document.querySelector('input[name="display_pref"]:checked').value;
            writePref(v);
            // Prefer to use the setter which broadcasts to other tabs and applies immediately
            try{ if (typeof window.setTeamNumberDisplayPreference === 'function') window.setTeamNumberDisplayPreference(v); else if (typeof window.applyTeamNumberDisplayPreference === 'function') window.applyTeamNumberDisplayPreference(); } catch(e){}
            showStatus('Preference saved locally. This setting is stored in your browser.', 'success');
        });

        document.getElementById('resetSettingsBtn').addEventListener('click', function(){
            try{ localStorage.removeItem('display_offseason_preference'); } catch(e){}
            document.getElementById('pref_99xx').checked = true;
            try{ if (typeof window.setTeamNumberDisplayPreference === 'function') window.setTeamNumberDisplayPreference('99xx'); else if (typeof window.applyTeamNumberDisplayPreference === 'function') window.applyTeamNumberDisplayPreference(); } catch(e){}
            showStatus('Preference reset to default (99xx).', 'secondary');
        });
    });
})();
</script>
{% endblock %}
